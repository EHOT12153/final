{
  "title": "Shop - API Gateway",
  "uid": "shop-gateway",
  "timezone": "browser",
  "schemaVersion": 38,
  "version": 1,
  "panels": [
    {
      "type": "timeSeries",
      "title": "Gateway RPS (total)",
      "gridPos": {"x":0,"y":0,"w":12,"h":8},
      "targets": [
        { "expr": "sum(rate(spring_cloud_gateway_requests_seconds_count[1m]))", "refId": "A" }
      ]
    },
    {
      "type": "timeSeries",
      "title": "Gateway 4xx/5xx",
      "gridPos": {"x":12,"y":0,"w":12,"h":8},
      "targets": [
        { "expr": "sum(rate(spring_cloud_gateway_requests_seconds_count{outcome=\"CLIENT_ERROR\"}[1m]))", "refId": "A" },
        { "expr": "sum(rate(spring_cloud_gateway_requests_seconds_count{outcome=\"SERVER_ERROR\"}[1m]))", "refId": "B" }
      ]
    },
    {
      "type": "timeSeries",
      "title": "Avg latency (gateway)",
      "gridPos": {"x":0,"y":8,"w":12,"h":8},
      "targets": [
        { "expr": "sum(rate(spring_cloud_gateway_requests_seconds_sum[1m])) / sum(rate(spring_cloud_gateway_requests_seconds_count[1m]))", "refId": "A" }
      ],
      "fieldConfig": { "defaults": { "unit": "s" } }
    },
    {
      "type": "timeSeries",
      "title": "RPS by routeId",
      "gridPos": {"x":12,"y":8,"w":12,"h":8},
      "targets": [
        { "expr": "sum by (routeId) (rate(spring_cloud_gateway_requests_seconds_count[1m]))", "refId": "A" }
      ]
    },
    {
      "type": "timeSeries",
      "title": "Latency by routeId (avg)",
      "gridPos": {"x":0,"y":16,"w":24,"h":8},
      "targets": [
        { "expr": "sum by (routeId) (rate(spring_cloud_gateway_requests_seconds_sum[1m])) / sum by (routeId) (rate(spring_cloud_gateway_requests_seconds_count[1m]))", "refId": "A" }
      ],
      "fieldConfig": { "defaults": { "unit": "s" } }
    }
  ]
}
